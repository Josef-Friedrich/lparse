\documentclass{article}

\usepackage{amsmath}

\begin{document}

\def\test{
  \directlua{
    local lparse = require('lparse')
    local oarg, marg = lparse.scan('O{} v')
    print(oarg, marg)
  }
}

% \newcommand{\test}[2][]{
%     \directlua{
%     print('#1', '#2')
%   }
% }

\begin{multline*}
p(x) = \test[1]{590}x^4y^2 + \test[2]{19}x^3y^3\\
- 12x^2y^4 - \test {12}xy^5
\end{multline*}

\end{document}
